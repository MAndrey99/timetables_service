# Описание api


## передаваемые объекты

#### Deadline
Используется для передачи информации о дедлайне в обоих направлениях.

Пример при отправке на сервис:  
_{ "creatorId": 7, "groupId": -1, "dateTime": "04-12-2020 23:18:30", "title": "example", "description": "" }_

Пример при получении клиентом:  
_{"creatorId":7,"groupId":-1,"dateTime":"04-12-2020 23:18:30","title":"example","description":"","id":53,"creationDateTime":"04-12-2020 23:17:16"}_

Поля:

обозначение | обязательно | тип | пояснение
---|---|---|---
**creatorId** | да | int | id создавшего дедлайн пользователя
**groupId** | да | int | id группы, в которой создан дедлайн
**dateTime** | да | String | время наступления дедлайна в формате dd-MM-yyyy HH:mm:ss
**title** | да | String | заголовок дедлайна
**description** | нет | String | пояснение дедлайна
**leadTime** | нет | int | предположительное время выполнения задачи в секундах
**id** | только для отправки клиенту | int | уникальный идентификатор дедлайна
**creationDateTime** | только для отправки клиенту | String | время создания дедлайна в формате dd-MM-yyyy HH:mm:ss
**priority** | нет | short | приоритет задачи


#### DeadlinesBucket
Используется для передачи клиенту информации о неком количестве дедлайнов.

Пример:  
_{"deadlines":\[{"creatorId":7,"groupId":-1,"dateTime":"04-12-2020 23:18:30","title":"t","description":"","id":53,"creationDateTime":"04-12-2020 23:17:16"},{"creatorId":7,"groupId":-1,"dateTime":"04-12-2020 23:18:30","title":"t","description":"","id":54,"creationDateTime":"04-12-2020 23:17:22"}]}_

Поля:

обозначение | обязательно | тип | пояснение
---|---|---|---
`deadlines` | да | Array | здесь все передаваемые [дедлайны](#deadline)


#### DeadlinePatch
Используется для изменения существующих дедлайнов.

Поля:

обозначение | обязательно | тип | пояснение
---|---|---|---
**dateTime** | нет | String | время наступления дедлайна в формате dd-MM-yyyy HH:mm:ss
**title** | нет | String | заголовок дедлайна
**description** | нет | String | пояснение дедлайна
**leadTime** | нет | int | предположительное время выполнения задачи в секундах
**priority** | нет | int | приоритет задачи


## методы

#### post /deadlines
Создаёт новый дедлайн по переданному в теле запроса [**Deadline**](#deadline).

Коды ошибок:
- **417** - переданный в теле запроса [**Deadline**](#deadline) имеет неверный формат.


#### patch /deadlines/`id`
Принимает [**DeadlinePatch**](#deadlinepatch) и изменяет соответствующие поля у [**Deadline**](#deadline)
с соответствующим id. Этим методом нельзя менять значения полей на Null.

Коды ошибок:
- **417** - переданный в теле запроса [**DeadlinePatch**](#deadlinepatch) имеет неверный формат.
- **404** - дедлайн с указанным id не найден.


#### get /deadlines
Возвращает [**DeadlinesBucket**](#deadlinesbucket).  

Аргументы:

обозначение | обязательно | тип | пояснение
---|---|---|---
`relevant` | нет(по-умолчанию true) | bool | указывает, требуется ли из выдачи убирать неактуальные(прошедшие) дедлайны.
`groupId` | нет | int | фильтрации выдачи по соответствующему полю Deadline
`creatorId` | нет | int | фильтрации выдачи по соответствующему полю Deadline


#### delete /deadlines/`id`
Удаляет дедлайн по переданному в url id.

Аргументы:

обозначение | обязательно | тип | пояснение
---|---|---|---
`groupId` | нет | int | groupId для предотвращения удаления дедлайнов из других групп

Коды ошибок:
- **204** - указанного дедлайна не существует
- **417** - groupId не соответствует указанному значению


#### get /schedule
Возвращает [**DeadlinesBucket**](#deadlinesbucket) предстоящих дедлайнов
с корректировкой dateTime.

Корректировка заключается в уменьшении dateTime дедлайна так,
чтобы, при начинании выполнения задачи за leadTime до дедлайна, все задачи были выполнены.
Об алгоритмах планирования можно почитать [здесь](aboutPlanning.md).

Например:  
Есть 2 дедлайна через 2 часа. На выполнение каждого нужен час.  
Тогда один из дедлайнов будет перенесён на час раньше.

Аргументы:

обозначение | обязательно | тип | пояснение
---|---|---|---
`groupId` | да | int | группа, для которой составляется расписание
`algorithm` | нет | String | Алгоритм планирования. По умолчанию prioritySRTF.

Коды ошибок:
- **417** - успеть выполнить все задачи невозможно
- **422** - указанный алгоритм не поддерживается


#### post /subscribers
Добавляет подписчика, которому будут присылаться все наступающие дедлайны в [**DeadlinesBucket**](#deadlinesbucket).  
В теле запроса необходимо передать **url**, на который методом post будет отправляться.  
Пример **url**:
http://localhost:8080/

Коды ошибок:
- **409** - подписчик с указанным url уже существует
- **417** - подписчик не смог обработать тестовый запрос


#### delete /subscribers
Удаляет подписчика.

Аргументы:

обозначение | обязательно | тип | пояснение
---|---|---|---
`url` | да | String | url подписчика, которого требуется удалить

Коды ошибок:
- **204** - указанного подписчика не существует
